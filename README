# Open vStorage VolumeDriver

## License

Apache 2.0 (see LICENSE) unless noted otherwise in the upstream components that
are part of this source tree (e.g. xmlrpc++, msgpack-c, TODO: remove these).

## Prerequisites

[volumedriver-buildtools](https://github.com/openvstorage/volumedriver-buildtools) and its prerequisites need to be installed. In addition to
that, the following tools and libraries (their development versions) need to be
present:

* arakoon
* libloki
* liblttng-ust
* libpython2.7
* librdmacm
* liburcu
* lttng-tools
* protobuf
* python-protobuf
* python-nose
* omniorb
* rpm
* zeromq 3.2.x

## Build Instructions

VolumeDriver uses autotools.

There are some scripts available under src/buildscripts to help setting up the build
correctly. By way of example:

(1) Create a custom build configuration, e.g.:
    #! /bin/bash
    set -eux
    # test .. this file should be in `pwd`!!!

    BUILDTOOLS_TO_USE=$(realpath ~/Projects/openvstorage/volumedriver-buildtools/rtchecked)
    VOLUMEDRIVER_DIR=$(realpath $1)
    BUILDER=$(realpath ${VOLUMEDRIVER_DIR}/src/buildscripts/builder.sh)
    BUILD_DIR=${VOLUMEDRIVER_DIR}/target/rtchecked

    export RUN_TESTS=no
    export COVERAGE=no
    export BUILD_NUM_PROCESSES=2
    export BUILD_DEBIAN_PACKAGES=${BUILD_DEBIAN_PACKAGES:-no}
    export CLEAN_BUILD=${CLEAN_BUILD:-"no"}
    export CXX_WARNINGS="-Wall -Wextra -Wno-unknown-pragmas -Wctor-dtor-privacy -Wsign-promo -Woverloaded-virtual -Wnon-virtual-dtor -Wno-unused-parameter -Wno-unused-local-typedef -Wno-mismatched-tags -Wno-deprecated-register -Wno-macro-redefined -Wno-redeclared-class-member"
    export SUPPRESS_WARNINGS=no

    mkdir -p ${BUILD_DIR}
    ln -sf ${BUILDER} $BUILD_DIR

    pushd $BUILD_DIR

    set +e
    ${BUILDER} $BUILDTOOLS_TO_USE $VOLUMEDRIVER_DIR
    ret=$?
    set -e

    popd

    exit ${ret}

(2) Run the build script:
    src/buildscripts/rtchecked.sh .
